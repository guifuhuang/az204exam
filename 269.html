<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Microsoft Graph API Integration</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        h1 {
            color: #0078d4;
            text-align: center;
        }
        .question-container {
            background-color: #f3f2f1;
            padding: 20px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .drag-drop-container {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        .drag-source {
            flex: 1;
            background-color: #f3f2f1;
            padding: 15px;
            border-radius: 5px;
            min-height: 300px;
        }
        .drop-target {
            flex: 2;
            background-color: #e5f5ff;
            padding: 15px;
            border-radius: 5px;
            min-height: 300px;
        }
        .drag-item {
            background-color: white;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 4px;
            border: 1px solid #ddd;
            cursor: move;
        }
        .drag-item:hover {
            background-color: #f0f0f0;
        }
        .drop-item {
            background-color: white;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 4px;
            border: 1px dashed #0078d4;
            min-height: 20px;
        }
        .button-container {
            text-align: center;
            margin-top: 20px;
        }
        button {
            background-color: #0078d4;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background-color: #005a9e;
        }
        .answer-section {
            display: none;
            margin-top: 30px;
            background-color: #f3f2f1;
            padding: 20px;
            border-radius: 5px;
        }
        .answer-section h3 {
            color: #0078d4;
            margin-top: 0;
        }
        .correct-answer {
            background-color: #dff6dd;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 15px;
        }
        .explanation {
            background-color: white;
            padding: 15px;
            border-radius: 4px;
        }
        .controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 10px;
        }
        .control-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 20px;
        }
        @media (max-width: 768px) {
            .drag-drop-container {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <h1>QUESTION NO: 269 DRAG DROP</h1>
    
    <div class="question-container">
        <p>You are developing an application to retrieve user profile information. The application will use the Microsoft Graph SDK.</p>
        <p>The app must retrieve user profile information by using a Microsoft Graph API call.</p>
        <p>You need to call the Microsoft Graph API from the application.</p>
        <p>In which order should you perform the actions? To answer, move all actions from the list of actions to the answer area and arrange them in the correct order.</p>
    </div>
    
    <div class="drag-drop-container">
        <div class="drag-source" id="source">
            <div class="drag-item" draggable="true" data-id="auth-provider">Create an authentication provider.</div>
            <div class="drag-item" draggable="true" data-id="graph-client">Create a new instance of the GraphServiceClient.</div>
            <div class="drag-item" draggable="true" data-id="invoke-request">Invoke the request to the Microsoft Graph API.</div>
            <div class="drag-item" draggable="true" data-id="register-app">Register the application with the Microsoft identity platform.</div>
            <div class="drag-item" draggable="true" data-id="build-client">Build a client by using the client app ID.</div>
        </div>
        <div class="drop-target" id="drop-area">
            <div class="controls">
                <button class="control-btn" id="move-up">▲</button>
                <button class="control-btn" id="move-down">▼</button>
            </div>
            <!-- <div id="drop-area"></div> -->
        </div>
    </div>
    
    <div class="button-container">
        <button id="check-answer">Check Answer</button>
    </div>
    
    <div id="answer-section" class="answer-section">
        <h3>Correct Answer and Explanation</h3>
        <div class="correct-answer">
            <p><strong>Correct Order:</strong></p>
            <ol>
                <li>Register the application with the Microsoft identity platform.</li>
                <li>Build a client by using the client app ID.</li>
                <li>Create an authentication provider.</li>
                <li>Create a new instance of the GraphServiceClient.</li>
                <li>Invoke the request to the Microsoft Graph API.</li>
            </ol>
        </div>
        <div class="explanation">
            <p><strong>中文说明：</strong></p>
            <p>1. <strong>在Microsoft身份平台注册应用程序</strong></p>
            <ul>
                <li>第一步必须在Azure AD中注册应用程序</li>
                <li>获取客户端ID和密钥/证书</li>
                <li>配置所需的API权限(如User.Read)</li>
                <li>设置重定向URI</li>
            </ul>
            
            <p>2. <strong>使用客户端应用程序ID构建客户端</strong></p>
            <ul>
                <li>使用注册应用时获得的客户端ID</li>
                <li>可能需要租户ID和客户端密钥</li>
                <li>示例: var clientApplication = PublicClientApplicationBuilder.Create(clientId).Build();</li>
            </ul>
            
            <p>3. <strong>创建一个身份验证提供程序</strong></p>
            <ul>
                <li>使用构建的客户端创建认证提供程序</li>
                <li>配置所需的Graph API权限范围</li>
                <li>示例: var authProvider = new DeviceCodeProvider(clientApplication, scopes);</li>
            </ul>
            
            <p>4. <strong>创建GraphServiceClient的新实例</strong></p>
            <ul>
                <li>使用认证提供程序初始化Graph客户端</li>
                <li>示例: var graphClient = new GraphServiceClient(authProvider);</li>
                <li>配置默认请求选项和设置</li>
            </ul>
            
            <p>5. <strong>向Microsoft Graph API发出请求</strong></p>
            <ul>
                <li>使用GraphServiceClient调用特定API</li>
                <li>示例: var user = await graphClient.Me.GetAsync();</li>
                <li>处理返回的用户配置文件数据</li>
            </ul>
            
            <p><strong>技术说明：</strong></p>
            <ul>
                <li>完整代码示例:
<pre style="background-color: #f5f5f5; padding: 10px; border-radius: 5px;">
// 1. 注册应用 (Azure门户完成)
// 2. 构建客户端
var clientApplication = PublicClientApplicationBuilder
    .Create("YOUR_CLIENT_ID")
    .Build();

// 3. 创建认证提供程序
var scopes = new[] { "User.Read" };
var authProvider = new DeviceCodeProvider(clientApplication, scopes);

// 4. 创建Graph客户端
var graphClient = new GraphServiceClient(authProvider);

// 5. 调用API
var user = await graphClient.Me.GetAsync();
Console.WriteLine($"Hello, {user.DisplayName}!");
</pre>
                </li>
                <li>认证流程:
                    <ol>
                        <li>用户通过设备代码流认证</li>
                        <li>获取访问令牌</li>
                        <li>令牌自动附加到API请求</li>
                    </ol>
                </li>
                <li>错误处理:
                    <ul>
                        <li>处理403 Forbidden(权限不足)</li>
                        <li>处理401 Unauthorized(令牌过期)</li>
                        <li>实现重试机制</li>
                    </ul>
                </li>
            </ul>
            
            <p><strong>参考文档：</strong> 
            <a href="https://docs.microsoft.com/en-us/graph/auth-v2-service" target="_blank">Microsoft Graph 认证指南</a> | 
            <a href="https://docs.microsoft.com/en-us/graph/sdks/create-client" target="_blank">创建Graph客户端</a></p>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const source = document.getElementById('source');
            const dropArea = document.getElementById('drop-area');
            const moveUpBtn = document.getElementById('move-up');
            const moveDownBtn = document.getElementById('move-down');
            const checkAnswerBtn = document.getElementById('check-answer');
            const answerSection = document.getElementById('answer-section');
            
            let draggedItem = null;
            let selectedDropItem = null;
            
            // Drag start event
            source.addEventListener('dragstart', function(e) {
                if (e.target.classList.contains('drag-item')) {
                    draggedItem = e.target;
                    e.dataTransfer.setData('text/plain', e.target.dataset.id);
                    setTimeout(() => {
                        e.target.style.opacity = '0.4';
                    }, 0);
                }
            });
            
            // Drag end event
            source.addEventListener('dragend', function(e) {
                if (e.target.classList.contains('drag-item')) {
                    setTimeout(() => {
                        e.target.style.opacity = '1';
                        draggedItem = null;
                    }, 0);
                }
            });
            
            // Drop area events
            dropArea.addEventListener('dragover', function(e) {
                e.preventDefault();
                e.dataTransfer.dropEffect = 'move';
            });
            
            dropArea.addEventListener('drop', function(e) {
                e.preventDefault();
                if (draggedItem) {
                    const newItem = document.createElement('div');
                    newItem.className = 'drop-item';
                    newItem.textContent = draggedItem.textContent;
                    newItem.dataset.id = draggedItem.dataset.id;
                    newItem.draggable = true;
                    
                    newItem.addEventListener('click', function() {
                        document.querySelectorAll('.drop-item').forEach(item => {
                            item.style.backgroundColor = 'white';
                        });
                        this.style.backgroundColor = '#e5f5ff';
                        selectedDropItem = this;
                    });
                    
                    newItem.addEventListener('dragstart', function(e) {
                        e.dataTransfer.setData('text/plain', this.dataset.id);
                        this.style.opacity = '0.4';
                    });
                    
                    newItem.addEventListener('dragend', function(e) {
                        this.style.opacity = '1';
                    });
                    
                    newItem.addEventListener('dragover', function(e) {
                        e.preventDefault();
                        e.dataTransfer.dropEffect = 'move';
                    });
                    
                    newItem.addEventListener('drop', function(e) {
                        e.preventDefault();
                        const data = e.dataTransfer.getData('text/plain');
                        const sourceItem = document.querySelector(`.drag-item[data-id="${data}"]`);
                        if (sourceItem) {
                            const newDropItem = document.createElement('div');
                            newDropItem.className = 'drop-item';
                            newDropItem.textContent = sourceItem.textContent;
                            newDropItem.dataset.id = sourceItem.dataset.id;
                            newDropItem.draggable = true;
                            
                            newDropItem.addEventListener('click', function() {
                                document.querySelectorAll('.drop-item').forEach(item => {
                                    item.style.backgroundColor = 'white';
                                });
                                this.style.backgroundColor = '#e5f5ff';
                                selectedDropItem = this;
                            });
                            
                            dropArea.insertBefore(newDropItem, this);
                            sourceItem.style.display = 'none';
                        }
                    });
                    
                    dropArea.appendChild(newItem);
                    draggedItem.style.display = 'none';
                    draggedItem = null;
                }
            });
            
            // Move items up/down
            moveUpBtn.addEventListener('click', function() {
                if (selectedDropItem && selectedDropItem.previousElementSibling) {
                    dropArea.insertBefore(selectedDropItem, selectedDropItem.previousElementSibling);
                }
            });
            
            moveDownBtn.addEventListener('click', function() {
                if (selectedDropItem && selectedDropItem.nextElementSibling) {
                    dropArea.insertBefore(selectedDropItem.nextElementSibling, selectedDropItem);
                }
            });
            
            // Check answer button
            checkAnswerBtn.addEventListener('click', function() {
                const correctOrder = [
                    'register-app',
                    'build-client',
                    'auth-provider',
                    'graph-client',
                    'invoke-request'
                ];
                
                const userOrder = [];
                document.querySelectorAll('#drop-area .drop-item').forEach(item => {
                    userOrder.push(item.dataset.id);
                });
                
                let isCorrect = true;
                if (userOrder.length !== correctOrder.length) {
                    isCorrect = false;
                } else {
                    for (let i = 0; i < correctOrder.length; i++) {
                        if (userOrder[i] !== correctOrder[i]) {
                            isCorrect = false;
                            break;
                        }
                    }
                }
                
                if (isCorrect) {
                    answerSection.querySelector('.correct-answer').style.backgroundColor = '#dff6dd';
                    alert('Correct! Well done!');
                } else {
                    answerSection.querySelector('.correct-answer').style.backgroundColor = '#ffebee';
                    alert('Not quite right. Please review the correct order.');
                }
                
                answerSection.style.display = 'block';
                window.scrollTo({
                    top: answerSection.offsetTop,
                    behavior: 'smooth'
                });
            });
        });
    </script>
</body>
</html>

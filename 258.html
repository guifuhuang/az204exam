<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Azure Managed Identities Token Retrieval</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        h1 {
            color: #0078d4;
            text-align: center;
        }
        .question-container {
            background-color: #f3f2f1;
            padding: 20px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .drag-drop-container {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        .drag-source-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        .drag-source {
            background-color: #f3f2f1;
            padding: 15px;
            border-radius: 5px;
            min-height: 150px;
        }
        .drop-target-container {
            flex: 1;
        }
        .drag-item {
            background-color: white;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 4px;
            border: 1px solid #ddd;
            cursor: move;
        }
        .drag-item:hover {
            background-color: #f0f0f0;
        }
        .code-block {
            background-color: #1e1e1e;
            color: #d4d4d4;
            padding: 15px;
            border-radius: 5px;
            font-family: Consolas, 'Courier New', monospace;
            white-space: pre;
            overflow-x: auto;
            position: relative;
        }
        .drop-placeholder {
            background-color: #ffeb3b;
            color: #000;
            padding: 2px 5px;
            border-radius: 3px;
            cursor: pointer;
        }
        .button-container {
            text-align: center;
            margin-top: 20px;
        }
        button {
            background-color: #0078d4;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background-color: #005a9e;
        }
        .answer-section {
            display: none;
            margin-top: 30px;
            background-color: #f3f2f1;
            padding: 20px;
            border-radius: 5px;
        }
        .answer-section h3 {
            color: #0078d4;
            margin-top: 0;
        }
        .correct-answer {
            background-color: #dff6dd;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 15px;
        }
        .explanation {
            background-color: white;
            padding: 15px;
            border-radius: 4px;
        }
        .segment-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: #0078d4;
        }
        @media (max-width: 768px) {
            .drag-drop-container {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <h1>QUESTION NO: 258 DRAG DROP</h1>
    
    <div class="question-container">
        <p>You are developing a web service that will run on Azure virtual machines that use Azure Storage.</p>
        <p>You configure all virtual machines to use managed identities.</p>
        <p>You have the following requirements:</p>
        <ul>
            <li>Secret-based authentication mechanisms are not permitted for accessing an Azure Storage account.</li>
            <li>Must use only Azure Instance Metadata Service endpoints.</li>
        </ul>
        <p>You need to write code to retrieve an access token to access Azure Storage. To answer, drag the appropriate code segments to the correct locations. Each code segment may be used once or not at all.</p>
        <p><strong>NOTE:</strong> Each correct selection is worth one point.</p>
    </div>
    
    <div class="drag-drop-container">
        <div class="drag-source-container">
            <div class="drag-source" id="source-segment1">
                <div class="segment-title">Segment 1</div>
                <div class="drag-item" draggable="true" data-id="1">http://localhost:50342/oauth2/token</div>
                <div class="drag-item" draggable="true" data-id="2">http://169.254.169.254/metadata/identity/oauth2/token</div>
                <div class="drag-item" draggable="true" data-id="3">http://localhost/metadata/identity/oauth2/token</div>
                <div class="drag-item" draggable="true" data-id="4">http://169.254.169.254/metadata/identity/oauth2/token</div>
            </div>
            <div class="drag-source" id="source-segment2">
                <div class="segment-title">Segment 2</div>
                <div class="drag-item" draggable="true" data-id="5">XmlDocument doc = new XmlDocument();</div>
                <div class="drag-item" draggable="true" data-id="6">new MultipartContent(payload);</div>
                <div class="drag-item" draggable="true" data-id="7">new NetworkCredential("Azure", payload);</div>
                <div class="drag-item" draggable="true" data-id="8">JsonConvert.DeserializeObject&lt;Dictionary&lt;string, string&gt;&gt;(payload);</div>
            </div>
        </div>
        <div class="drop-target-container">
            <div class="code-block">
var url="<span class="drop-placeholder" id="drop-segment1">【Segment 1】</span>";
var queryString = "...";
var client = new HttpClient();
var response = await client.GetAsync(url,queryString);
var payload = await response.Content.ReadAsStringAsync();
return <span class="drop-placeholder" id="drop-segment2">【Segment 2】</span>;
            </div>
        </div>
    </div>
    
    <div class="button-container">
        <button id="check-answer">Check Answer</button>
    </div>
    
    <div id="answer-section" class="answer-section">
        <h3>Correct Answer and Explanation</h3>
        <div class="correct-answer">
            <p><strong>Correct Selections:</strong></p>
            <ul>
                <li>Segment 1: http://169.254.169.254/metadata/identity/oauth2/token</li>
                <li>Segment 2: JsonConvert.DeserializeObject&lt;Dictionary&lt;string, string&gt;&gt;(payload);</li>
            </ul>
        </div>
        <div class="explanation">
            <p><strong>中文说明：</strong></p>
            <p>1. <strong>Segment 1: Token Endpoint</strong></p>
            <ul>
                <li>必须使用Azure实例元数据服务端点：http://169.254.169.254/metadata/identity/oauth2/token</li>
                <li>这是Azure托管身份的标准端点</li>
                <li>本地开发端点(localhost)不符合题目要求</li>
            </ul>
            
            <p>2. <strong>Segment 2: Payload Processing</strong></p>
            <ul>
                <li>选择JsonConvert.DeserializeObject方法</li>
                <li>这是处理JSON响应的标准方法</li>
                <li>XML处理方法不符合题目要求</li>
                <li>NetworkCredential方法不适用于此场景</li>
            </ul>
            
            <p><strong>技术说明：</strong></p>
            <ul>
                <li>完全符合题目要求：不使用密钥认证，仅使用元数据服务</li>
                <li>遵循Azure托管身份最佳实践</li>
                <li>异步操作提高应用性能</li>
                <li>使用JSON处理令牌响应，这是标准做法</li>
            </ul>
            
            <p><strong>完整代码示例：</strong></p>
            <pre>async Task&lt;Dictionary&lt;string, string&gt;&gt; GetAccessTokenAsync()
{
    var url = "http://169.254.169.254/metadata/identity/oauth2/token";
    var queryString = "resource=https://management.azure.com/&client_id={clientId}&grant_type=client_credentials";
    var client = new HttpClient();
    var response = await client.GetAsync(url + "?" + queryString);
    var payload = await response.Content.ReadAsStringAsync();
    return JsonConvert.DeserializeObject&lt;Dictionary&lt;string, string&gt;&gt;(payload);
}</pre>
            
            <p><strong>参考文档：</strong> <a href="https://docs.microsoft.com/en-us/azure/active-directory/managed-identities-azure-resources/how-to-use-vm-token" target="_blank">Azure托管身份文档</a></p>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const sourceSegment1 = document.getElementById('source-segment1');
            const sourceSegment2 = document.getElementById('source-segment2');
            const dropSegment1 = document.getElementById('drop-segment1');
            const dropSegment2 = document.getElementById('drop-segment2');
            const checkAnswerBtn = document.getElementById('check-answer');
            const answerSection = document.getElementById('answer-section');
            
            let draggedItem = null;
            
            // Drag start event
            function handleDragStart(e) {
                if (e.target.classList.contains('drag-item')) {
                    draggedItem = e.target;
                    e.dataTransfer.setData('text/plain', e.target.dataset.id);
                    setTimeout(() => {
                        e.target.style.opacity = '0.4';
                    }, 0);
                }
            }
            
            // Drag end event
            function handleDragEnd(e) {
                if (e.target.classList.contains('drag-item')) {
                    setTimeout(() => {
                        e.target.style.opacity = '1';
                        draggedItem = null;
                    }, 0);
                }
            }
            
            // Drag over event
            function handleDragOver(e) {
                if (e.target.classList.contains('drop-placeholder')) {
                    e.preventDefault();
                }
            }
            
            // Drop event
            function handleDrop(e) {
                if (e.target.classList.contains('drop-placeholder') && draggedItem) {
                    e.preventDefault();
                    
                    // Replace the placeholder with the dragged item's text
                    e.target.textContent = draggedItem.textContent;
                    e.target.style.backgroundColor = '#dff6dd';
                    e.target.style.color = '#000';
                    e.target.style.cursor = 'default';
                    e.target.draggable = false;
                    
                    // Store the original placeholder ID for answer checking
                    e.target.dataset.originalId = e.target.id;
                }
            }
            
            // Add event listeners
            document.querySelectorAll('.drag-item').forEach(item => {
                item.addEventListener('dragstart', handleDragStart);
                item.addEventListener('dragend', handleDragEnd);
            });
            
            dropSegment1.addEventListener('dragover', handleDragOver);
            dropSegment2.addEventListener('dragover', handleDragOver);
            dropSegment1.addEventListener('drop', handleDrop);
            dropSegment2.addEventListener('drop', handleDrop);
            
            // Check answer button
            checkAnswerBtn.addEventListener('click', function() {
                answerSection.style.display = 'block';
                window.scrollTo({
                    top: answerSection.offsetTop,
                    behavior: 'smooth'
                });
            });
        });
    </script>
</body>
</html>
